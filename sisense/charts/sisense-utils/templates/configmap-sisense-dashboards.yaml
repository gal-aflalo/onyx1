{{- if .Values.dashboard.enabled -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: {{ .Release.Namespace }}
  labels: {{- include "sisense-utils.labels" . | nindent 4 }}
    grafana_dashboard: "1"
data:
{{- if ne .Values.global.clusterVisibility false }}
{{- $kubeVersion := trimPrefix "v" (first (lookup "v1" "Node" "" "").items).status.nodeInfo.kubeletVersion -}}
{{- if semverCompare ">= 1.21" (trimSuffix "." (substr 0 4 $kubeVersion)) }}
{{ tpl (.Files.Glob "sisense-dashboards/*").AsConfig . | indent 2 }}
{{- else }} 
{{ tpl (.Files.Glob "sisense-dashboards-old/*").AsConfig . | indent 2 }}
{{- end }}
{{- end -}}
{{- end }}